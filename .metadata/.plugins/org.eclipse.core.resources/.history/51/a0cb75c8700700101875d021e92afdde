/*
 * generated by Xtext 2.37.0
 */
package uk.ac.kcl.inf.languages.turtles.validation
import org.eclipse.xtext.validation.Check;

import uk.ac.kcl.inf.languages.turtles.turtlesLanguage.AddTask
import uk.ac.kcl.inf.languages.turtles.turtlesLanguage.TurtleProgram
import uk.ac.kcl.inf.languages.turtles.turtlesLanguage.TurtlesLanguagePackage

/**
 * This class contains custom validation rules. 
 *
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
class TurtlesLanguageValidator extends AbstractTurtlesLanguageValidator {
	@Check
	def checkNoCircularDependencies(AddTask task) {
        val dependencies = task.dependencies
        if (dependencies.exists[it.dependencies.contains(task)]) {
            error("Circular dependency detected", null)
        }
    }
    @Check
	def void checkTaskNameCapitalized(AddTask task) {
	    if (task.name !== null && !Character.isUpperCase(task.name.charAt(0))) {
	        warning("Task name should start with a capital letter", 
	            task, 
	            TurtlesLanguagePackage.Literals.ADD_TASK__NAME, 
	            "CAPITALIZE_NAME") 
	    }
	}
    
//priority must be positive
    @Check
    def checkPriorityIsPositive(AddTask task) {
        if (task.priority <= 0) {
            error("Priority must be positive", null)
        }
    }
//task id must be unique
    @Check
    def checkTaskIdIsUnique(AddTask task) {
        val program = task.eContainer as TurtleProgram
        val tasks = program.statements.filter(AddTask)
        if (tasks.exists[it.id == task.id && it != task]) {
            error("Task ID must be unique", null)
        }
    }
    
//check repeat>0
    @Check
	def checkRepeatCount(AddTask task) { 
	if (task.repeatCount <= 0) {
		error("Repeat count must be a positive integer", task, TurtlesLanguagePackage.Literals.ADD_TASK__REPEAT_COUNT)
	}
}
    }

	

